/*!
 * ====================================================
 * kv-markdown.js
 * ====================================================
 * A markdown editor jquery plugin parsed using PHP Markdown Extra  
 * and PHP SmartyPants. Designed for Yii Framework 2.0
 *
 * https://github.com/kartik-v/yii2-markdown
 *
 * Copyright (c) 2015 - 2018, Kartik Visweswaran
 * Krajee.com
 * Licensed under BSD-3 License.
 * Refer attached LICENSE.md for details.
 * Version: 1.3.1
 */!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(window.jQuery)}(function(e){"use strict";var t,n;String.prototype.trimRight=function(e){return void 0===e&&(e="s"),this.replace(new RegExp("["+e+"]+$"),"")},String.prototype.repeat=function(e){return e=e||1,Array(e+1).join(this)},t={el:function(t){return e("#"+t)},isEmpty:function(t,n){return null===t||void 0===t||t==[]||""===t||n&&""===e.trim(t)},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getMarkUp:function(e,t,n){var r=t.length,i=n.length,o=e;return r>0&&(o=o.slice(0,r)==t?o.slice(r):t+o),i>0&&(o=o.slice(-i)==n?o.slice(0,-i):o+n),o},getBlockMarkUp:function(n,r,i){var o=[];return n.indexOf("\n")<0?t.getMarkUp(n,r,i):(o=n.split("\n"),e.each(o,function(e,n){o[e]=t.getMarkUp(n.trimRight(),r,i+"  ")}),o.join("\n"))},markup:function(n,r){var i,o=[],a=r,s=r.length,l="  ",u=1;switch(n){case 1:return s>0?t.getBlockMarkUp(r,"**","**"):"**(bold text here)**";case 2:return s>0?t.getBlockMarkUp(r,"*","*"):"*(italic text here)*";case 3:return s>0?t.getMarkUp(r,"\n","\n"):"\n(paragraph text here)\n";case 4:return t.getBlockMarkUp(r,"","  ");case 5:return i=prompt("Insert Hyperlink","http://"),null!=i&&""!=i&&"http://"!=i?"["+r+"]("+i+")":r;case 6:return i=prompt("Insert Image Hyperlink","http://"),null!=i&&""!=i&&"http://"!=i?"!["+r+"]("+i+' "enter image title here")':r;case 7:return a.indexOf("\n")<0?a=l+a:(o=r.split("\n"),e.each(o,function(e,t){o[e]=l+t}),a=o.join("\n")),a;case 8:return a.indexOf("\n")<0&&a.substr(0,2)==l?a=a.slice(2):(o=r.split("\n"),e.each(o,function(e,t){o[e]=t,t.substr(0,2)==l&&(o[e]=t.slice(2))}),a=o.join("\n")),a;case 9:return t.getBlockMarkUp(r,"- ","");case 10:var c=prompt("Enter starting number",1);return null!=c&&""!=c?(t.isNumber(c)||(c=1),r.indexOf("\n")>=0?(u=c,o=r.split("\n"),e.each(o,function(e,n){o[e]=t.getMarkUp(n,u+". ",""),u++}),o.join("\n")):t.getMarkUp(r,c+". ","")):a;case 11:return r.indexOf("\n")>0?(o=r.split("\n"),e.each(o,function(e,n){tag=u%2==0?":    ":"",o[e]=t.getMarkUp(n,tag,""),u++}),o.join("\n")):r+"\n:    \n";case 12:var p="Enter footnote ",d="";return r.indexOf("\n")<0?(d="[^1]: "+p+"1\n",t.getMarkUp(r,"",p+"[^1]")+"\n"+d):(o=r.split("\n"),e.each(o,function(e,n){id="[^"+u+"]",o[e]=t.getMarkUp(n,"",id+"  "),d=d+id+": "+p+u+"\n",u++}),o.join("\n")+"  \n\n"+d);case 13:return t.getBlockMarkUp(r,"> ","  ");case 14:return t.getMarkUp(r,"`","`");case 15:var f=prompt("Enter code language (e.g. html)","");return isEmpty(f,!0)&&(f=""),t.getMarkUp(r,"~~~"+f+" \n","\n~~~  \n");case 16:return t.getMarkUp(r,"","\n- - -");default:if(n>100){var h=n-100,g="#".repeat(h);return t.getMarkUp(r,g+" "," "+g)}}return r}},n=function(t,n){var r=this;r.$element=e(t),r.options=n,r.init()},n.prototype={constructor:n,init:function(){var n=this,r=n.options;n.$container=t.el(r.containerId),n.$editor=t.el(r.editorId),n.$previewContainer=t.el(r.previewContainerId),n.$previewButton=t.el(r.previewButtonId),n.$maximizeButton=t.el(r.maximizeButtonId),n.$export1Button=t.el(r.export1ButtonId),n.$export2Button=t.el(r.export2ButtonId),n.$element.on("focus",function(){n.$editor.addClass("active")}),n.$element.on("blur",function(){n.$editor.removeClass("active")}),n.$container.find('[data-tool="md-button"]').on("click",function(t){t.preventDefault(),n.markup(e(this).data("key"))}),n.$previewButton.on("click",function(){n.togglePreview()}),n.$export1Button.on("click",function(e){e.preventDefault(),n.genExportFile("Text")}),n.$export2Button.on("click",function(e){e.preventDefault(),n.genExportFile("HTML")}),n.$maximizeButton.on("click",function(){e(this).toggleClass("active"),n.setHeight(!0)}),n.setHeight()},setHeight:function(t){var n=this,r=n.$container.outerHeight(),i=n.options.height;t&&n.$container.toggleClass("kv-fullscreen"),n.$container.hasClass("kv-fullscreen")&&(i=e(window).height()-r+i),n.$element.css("height",i),n.$previewContainer.css("height",i)},enableButtons:function(){var t=this;t.$editor.find("button").each(function(){e(this).removeAttr("disabled")})},disableButtons:function(){var t=this;t.$editor.find("button").each(function(){void 0==e(this).attr("data-enabled")&&e(this).attr("disabled","disabled")})},markup:function(e){var n=this,r=n.$element;r.focus();var i=r.extractSelectedText(),o=t.markup(e,i);t.isEmpty(o)||r.replaceSelectedText(o,"select")},genExportFile:function(t){var n=this,r=n.options,i=r.exportHeader+n.$element.val();"HTML"==t?e.ajax({type:"POST",url:r.previewAction,dataType:"json",data:{source:i,nullMsg:r.nullMsg},success:function(e){if(e){var t=r.exportMeta+r.exportCss+e;n.download("htm",t)}else alert("HTML conversion failed! Try again later.")}}):n.download("txt",i)},togglePreview:function(){var t=this;t.$previewButton.toggleClass("active"),t.$previewContainer.hasClass("hidden")?(t.disableButtons(),t.$previewButton.removeAttr("disabled"),t.$element.addClass("hidden"),t.$previewContainer.removeClass("hidden"),e.ajax({type:"POST",url:t.options.previewAction,dataType:"json",data:{source:t.$element.val(),smarty:t.options.smarty,nullMsg:t.options.nullMsg},beforeSend:function(){t.$previewContainer.html(t.options.progress)},success:function(e){t.$previewContainer.html(e)}}),t.$previewContainer.focus()):(t.enableButtons(),t.$element.removeClass("hidden"),t.$previewContainer.addClass("hidden"),t.$element.focus())},download:function(t,n){var r=this,i=r.$element.attr("id")+"-iframe",o="#"+i,a=e("<input/>",{name:"export_filetype",value:t,type:"hidden"}),s=e("<input/>",{name:"export_filename",value:r.options.filename,type:"hidden"}),l=e("<input/>",{name:yii.getCsrfParam()||"_csrf",value:yii.getCsrfToken(),type:"hidden"}),u=e("<textarea/>",{name:"export_content"}).val(n),c=r.options.downloadAction,p={action:c,target:i,method:"post",css:{display:"none"}};e(o).length||e("<iframe/>",{name:i,css:{display:"none"}}).appendTo("body"),e("<form/>",p).append(a,s,l,u).appendTo("body").submit().remove()}},e.fn.kvMarkdown=function(t){var r=Array.apply(null,arguments),i=[];switch(r.shift(),this.each(function(){var o,a=e(this),s=a.data("kvMarkdown"),l="object"==typeof t&&t;s||(o=e.extend(!0,{},l,a.data()),s=new n(this,o),a.data("kvMarkdown",s)),"string"==typeof t&&i.push(s[t].apply(s,r))}),i.length){case 0:return this;case 1:return i[0];default:return i}}});